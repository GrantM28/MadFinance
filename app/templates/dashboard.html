{% extends 'base.html' %}
{% block content %}
<div class="row g-4 mb-5">
    <div class="col-md-4">
        <div class="stat-card">
            <div class="metric-label">Debt Monster Balance</div>
            <div class="metric-value text-danger">${{ "%.2f"|format(total_debt) }}</div>
            <small class="text-muted">Weighted APR: {{ "%.2f"|format(avg_apr) }}%</small>
        </div>
    </div>
    <div class="col-md-4">
        <div class="stat-card">
            <div class="metric-label">DTI (Financial Health)</div>
            <div class="metric-value {{ 'text-danger' if dti > 36 else 'text-info' }}">{{ "%.1f"|format(dti) }}%</div>
            <small class="text-muted">Goal: Stay below 36%</small>
        </div>
    </div>
    <div class="col-md-4">
        <div class="stat-card">
            <div class="metric-label">Monthly "Attack Power"</div>
            <div class="metric-value text-success">${{ "%.2f"|format(summary.cashflow) }}</div>
            <small class="text-muted">Available for Snowball/Avalanche</small>
        </div>
    </div>
</div>

<h4 class="fw-bold mb-4">The Cashflow Schedule</h4>
{% for group in groups %}
<div class="stat-card mb-4 pay-group-{{ loop.index % 3 + 1 }}">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h5 class="fw-bold m-0 text-primary">Check Date: {{ group.date.strftime('%m/%d/%Y') }}</h5>
        <span class="remainder-pill">Left to Attack Debt: ${{ "%.2f"|format(group.remainder) }}</span>
    </div>
    <table class="table table-dark table-sm border-0 m-0">
        <thead>
            <tr class="label"><th>DUE DATE</th><th>EXPENSE</th><th class="text-end">AMOUNT</th></tr>
        </thead>
        <tbody>
            {% for b in group.bills %}
            <tr>
                <td>{{ b.due_date.strftime('%m/%d') }}</td>
                <td>{{ b.name }}</td>
                <td class="text-end text-danger">-${{ "%.2f"|format(b.amount) }}</td>
            </tr>
            {% endfor %}
            <tr class="border-top border-secondary">
                <td colspan="2" class="text-muted small">Check Amount: +${{ "%.2f"|format(group.income) }}</td>
                <td class="text-end fw-bold">Check Remainder: ${{ "%.2f"|format(group.remainder) }}</td>
            </tr>
        </tbody>
    </table>
</div>
{% endfor %}
{% endblock %}